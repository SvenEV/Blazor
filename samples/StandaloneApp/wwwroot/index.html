<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Blazor standalone</title>
    <base href="/" />
    <link href="css/bootstrap/bootstrap.min.css" rel="stylesheet" />
    <link href="css/site.css" rel="stylesheet" />
</head>
<body>
    <app>Loading...</app>

    <div id="xamzorMeasureContainer" style="display: inline-block; visibility: hidden;">
        <!-- function "measureHtml will temporarily place elements here to measure them -->
    </div>

    <script src="css/bootstrap/bootstrap-native.min.js"></script>
    <script type="blazor-boot">
    </script>

    <!-- Xamzor script for measuring HTML content -->
    <script type="text/javascript">
        Blazor.registerFunction('measureHtml', (data) => {
            var container = document.getElementById('xamzorMeasureContainer');

            if (container == null)
                return "0,0";

            container.innerHTML = data;
            var result = container.offsetWidth + "," + container.offsetHeight;
            container.innerHTML = "";
            return result;
        });

        Blazor.registerFunction('measureImage', (source) => {
            var img = document.createElement('img');
            img.src = source;

            img.onload = function () {
                returnResult();
                document.body.removeChild(img);
            };

            img.onerror = function () {
                returnResult();
                document.body.removeChild(img);
            };

            document.body.appendChild(img);

            function returnResult() {
                const assemblyName = 'StandaloneApp';
                const namespace = 'StandaloneApp.UI';
                const typeName = 'ImageMeasureInterop';
                const methodName = 'NotifyImageMeasured';

                const method = Blazor.platform.findMethod(
                    assemblyName,
                    namespace,
                    typeName,
                    methodName
                );

                let arg1AsDotNetString = Blazor.platform.toDotNetString(source);
                let arg2AsDotNetString = Blazor.platform.toDotNetString(img.naturalWidth + ',' + img.naturalHeight);

                let resultAsDotNetString = Blazor.platform.callMethod(method, null, [
                    arg1AsDotNetString,
                    arg2AsDotNetString
                ]);
            }
        });
    </script>
</body>
</html>
